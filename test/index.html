<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asitha • YouTube Downloader</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
  body { opacity:0; transition: opacity 0.6s ease-in-out; }
  .animate-fade-in { animation: fadeIn 0.6s ease-in-out forwards; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }
</style>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-900 dark:to-gray-950 min-h-screen flex items-center justify-center p-4">

<div class="w-full max-w-3xl mx-auto">
  <!-- Header -->
  <div class="text-center mb-10 space-y-4">
    <h1 class="text-5xl font-extrabold bg-gradient-to-r from-red-600 to-pink-500 bg-clip-text text-transparent">
      Asitha YT Downloader
    </h1>
    <p class="text-gray-600 dark:text-gray-400">Download Video & Audio • High Quality • Fast • Secure</p>
  </div>

  <!-- Input Card -->
  <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-xl p-6 mb-8">
    <input type="text" id="youtubeUrl" placeholder="Paste YouTube URL here..."
      class="w-full border border-gray-300 dark:border-gray-700 rounded-xl p-4 mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500">
    <button onclick="getVideoInfo()"
      class="w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white py-4 rounded-xl font-semibold shadow-lg transition-all duration-300">
      Get Video Info
    </button>
  </div>

  <!-- Video Info Card -->
  <div id="videoInfo" class="hidden animate-fade-in bg-white dark:bg-gray-800 rounded-3xl shadow-xl overflow-hidden">
    <div class="relative" id="thumbnailContainer"></div>
    <div class="p-6 space-y-4">
      <h2 id="videoTitle" class="text-2xl font-bold text-gray-900 dark:text-gray-100 line-clamp-2"></h2>
      <div class="flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400">
        <span id="channelName" class="flex items-center gap-2"></span>
        <span id="duration" class="flex items-center gap-2"></span>
      </div>

      <!-- Download Buttons -->
      <div class="grid gap-3 sm:grid-cols-2 mt-4">
        <button onclick="downloadAudio()" class="bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl flex items-center justify-center gap-2 font-medium shadow-md">
          MP3 (128kbps)
        </button>
        <button onclick="downloadVideo('360')" class="bg-red-500 hover:bg-red-600 text-white py-3 rounded-xl flex items-center justify-center gap-2 font-medium shadow-md">
          MP4 (360p)
        </button>
        <button onclick="downloadVideo('480')" class="bg-red-500 hover:bg-red-600 text-white py-3 rounded-xl flex items-center justify-center gap-2 font-medium shadow-md">
          MP4 (480p)
        </button>
        <button onclick="downloadVideo('720')" class="bg-red-500 hover:bg-red-600 text-white py-3 rounded-xl flex items-center justify-center gap-2 font-medium shadow-md">
          MP4 (720p)
        </button>
        <button onclick="downloadVideo('1080')" class="bg-red-500 hover:bg-red-600 text-white py-3 rounded-xl flex items-center justify-center gap-2 font-medium shadow-md sm:col-span-2">
          MP4 (1080p)
        </button>
      </div>
    </div>
  </div>
</div>

<script>
const Toast = Swal.mixin({toast:true, position:'top-end', showConfirmButton:false, timer:3000, timerProgressBar:true,
  didOpen: (toast) => { toast.addEventListener('mouseenter', Swal.stopTimer); toast.addEventListener('mouseleave', Swal.resumeTimer);}
});
function showLoading(msg){return Swal.fire({html:`<div class="space-y-3"><div class="w-16 h-16 mx-auto border-4 border-gray-200 border-t-blue-500 rounded-full animate-spin"></div><div class="text-gray-600 text-sm">${msg}</div></div>`,showConfirmButton:false,allowOutsideClick:false,background:'#fff',customClass:{popup:'rounded-2xl'}});}
function showSuccess(msg){Toast.fire({icon:'success',title:msg,background:'#F0FDF4',iconColor:'#22C55E'});}
function showError(msg){Toast.fire({icon:'error',title:msg,background:'#FEF2F2',iconColor:'#EF4444'});}

// Get Video Info from API
function getVideoInfo() {
  const url = $('#youtubeUrl').val().trim();
  if(!url) return showError('Please enter a YouTube URL');
  showLoading('Fetching video info...'); $('#videoInfo').addClass('hidden');

  // API call for video info
  $.ajax({
    url:`http://vpn.asitha.top:3000/api/ytmp3?url=${encodeURIComponent(url)}`,
    type:'GET',
    success:(res)=>{
      // Example: res should contain {title, thumbnail, author, duration}
      $('#thumbnailContainer').html(`<img src="${res.thumbnail}" class="w-full object-cover">`);
      $('#videoTitle').text(res.title);
      $('#channelName').text(res.author);
      $('#duration').text(res.duration);
      $('#videoInfo').removeClass('hidden'); Swal.close(); showSuccess('Video info loaded');
    },
    error:(xhr)=>{Swal.close(); showError('Failed to fetch video info');}
  });
}

// Download functions
function downloadAudio() {
  const url = $('#youtubeUrl').val().trim();
  if(!url) return showError('Please enter a YouTube URL');
  showLoading('Preparing MP3...');
  const apiUrl = `http://vpn.asitha.top:3000/api/ytmp3?url=${encodeURIComponent(url)}`;
  const a = document.createElement('a'); a.href=apiUrl; a.download=''; document.body.appendChild(a); a.click(); document.body.removeChild(a);
  Swal.close(); showSuccess('Download started!');
}
function downloadVideo(quality) {
  const url = $('#youtubeUrl').val().trim();
  if(!url) return showError('Please enter a YouTube URL');
  showLoading(`Preparing MP4 (${quality}p)...`);
  const apiUrl = `http://vpn.asitha.top:3000/api/ytmp4?url=${encodeURIComponent(url)}&quality=${quality}`;
  const a = document.createElement('a'); a.href=apiUrl; a.download=''; document.body.appendChild(a); a.click(); document.body.removeChild(a);
  Swal.close(); showSuccess(`MP4 (${quality}p) download started!`);
}

// Fade in page
document.addEventListener('DOMContentLoaded',()=>{document.body.style.opacity='1';});
</script>

</body>
</html>
